rm(list=ls())
library(mgcv)

fun1<-function(n1,n2,n3,mu,l1,l2,l3)
{
  g1<-rig(n1,mu,1/l1);g2<-rig(n2,mu,1/l2);g3<-rig(n3,mu,1/l3)
  m1=mean(g1);m2=mean(g2);m3=mean(g3)
  s1<-var(g1);s2<-var(g2);s3<-var(g3)
  V1<-sqrt(s1/n1+s2/n2);V2<-sqrt(s2/n2+s3/n3)
  T1=(m2-m1)/V1;T2=(m3-m2)/V2
  A=max(T1,T2,na.rm = FALSE)
  return(A)
}
fun2<-function(n1,n2,n3,mu,l1,l2,l3)
{
  x<-replicate(1000,fun1(n1,n2,n3,mu,l1,l2,l3))
  y<-sort(x,decreasing=FALSE)
  c<-y[950]
  return(c)
}

fun3<-function(n1,n2,n3,mu1,mu2,mu3,l1,l2,l3)
{
  g1<-rig(n1,mu1,1/l1);g2<-rig(n2,mu2,1/l2);g3<-rig(n3,mu3,1/l3)
  m1=mean(g1);m2=mean(g2);m3=mean(g3)
  s1<-var(g1);s2<-var(g2);s3<-var(g3)
  V1<-sqrt(s1/n1+s2/n2);V2<-sqrt(s2/n2+s3/n3)
  T1=(m2-m1)/V1;T2=(m3-m2)/V2
  A=max(T1,T2,na.rm = FALSE)
  #mu=(n1*(1/s1)*m1+n2*(1/s2)*m2+n3*(1/s3)*m3)/(n1*(1/s1)+n2*(1/s2)+n3*(1/s3))
  mu=(n1*m1+n2*m2+n3*m3)/(n1+n2+n3)
  L1<-sum(1/g1)/n1-1/m1
  L2<-sum(1/g2)/n2-1/m2
  L3<-sum(1/g3)/n3-1/m3
  out=fun2(n1,n2,n3,mu,1/L1,1/L2,1/L3)
  a=0
  if(A>out)
    a=a+1
  return(a)
}

fun4<-function(n1,n2,n3,mu1,mu2,mu3,v1,v2,v3)
{
  out<-replicate(1000,fun3(n1,n2,n3,mu1,mu2,mu3,v1,v2,v3))
  p<-sum(out)/1000
  return(p)
}


###For size values in Table 7.3

p<-replicate(5,fun4(30,20,25,1,1,1,1,1,1))
p;mean(p)
p<-replicate(5,fun4(30,20,25,1,1,1,5,5,5))
p;mean(p)
p<-replicate(5,fun4(30,20,25,1,1,1,10,10,10))
p;mean(p)
p<-replicate(5,fun4(30,20,25,5,5,5,6,8,7))
p;mean(p)
p<-replicate(5,fun4(30,20,25,5,5,5,50,50,50))
p;mean(p)
p<-replicate(5,fun4(30,20,25,5,5,5,60,50,50))
p;mean(p)
p<-replicate(5,fun4(30,20,25,10,10,10,12,16,14))
p;mean(p)
p<-replicate(5,fun4(30,20,25,10,10,10,80,90,60))
p;mean(p)
p<-replicate(5,fun4(30,20,25,10,10,10,100,100,100))
p;mean(p)

##For size values in Table 7.3

p<-replicate(5,fun4(50,40,60,1,1,1,1,1,1))
p;mean(p)
p<-replicate(5,fun4(50,40,60,1,1,1,5,5,5))
p;mean(p)
p<-replicate(5,fun4(50,40,60,1,1,1,10,10,10))
p;mean(p)
p<-replicate(5,fun4(50,40,60,5,5,5,6,8,7))
p;mean(p)
p<-replicate(5,fun4(50,40,60,5,5,5,50,50,50))
p;mean(p)
p<-replicate(5,fun4(50,40,60,5,5,5,60,50,50))
p;mean(p)
p<-replicate(5,fun4(50,40,60,10,10,10,12,16,14))
p;mean(p)
p<-replicate(5,fun4(50,40,60,10,10,10,80,90,60))
p;mean(p)
p<-replicate(5,fun4(50,40,60,10,10,10,100,100,100))
p;mean(p)

### For power values in Table 7.6

p<-replicate(5,fun4(20,25,30,1,2,2.2,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,2.4,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,2.6,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,2.8,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,3,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,3.2,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,3.4,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,3.6,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,3.8,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,4,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,4.2,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,4.4,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,4.6,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,4.8,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,5,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,5.2,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,5.4,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,5.6,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,5.8,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,6,1,1,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,6.2,1,1,1))
p;mean(p)



p<-replicate(5,fun4(20,25,30,1,2,2.2,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,2.4,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,2.6,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,2.8,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,3,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,3.2,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,3.4,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,3.6,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,3.8,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,4,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,4.2,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,4.4,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,4.6,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,4.8,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,5,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,5.2,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,5.4,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,5.6,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,5.8,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,6,5,7,1))
p;mean(p)
p<-replicate(5,fun4(20,25,30,1,2,6.2,5,7,1))
p;mean(p)

